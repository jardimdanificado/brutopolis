<html>
    <head>
        <title>Draw on html canvas</title>
    </head>
    <body>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.2/p5.min.js" integrity="sha512-eu9vkh+EbAsW3fMmPTj/DP5W3UegIdu0Z/OABMocvoofx43MYBkcQ9hRIVxZndV1vcCYQwBg+U1PkWl04TD0Jg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src='lib/fengari-web.js' type="text/javascript"></script>
        <script type="text/javascript">
            let imgs = {}

            preload = function()
            {
                imgs.human = loadImage("data/img/human.png")
                imgs.floor = loadImage("data/img/floor.png")
                imgs.wall = loadImage("data/img/wall.png")
                imgs.door = loadImage("data/img/door.png")
                console.log("aoba")
            }

            setup = function()
            {
                createCanvas(400, 400)
            }

            async function main()
            {
                //brutopolis code
                fengari.load(await fetch("entrypoint.lua").then(response => response.text()))()

                draw = function()
                {
                    background(220)
                    for (let x = 0; x < window.brout.room.length; x++)
                    {
                        for (let y = 0; y < window.brout.room[x].length; y++)
                        {
                            if (window.brout.room[x][y] == 32)
                            {
                                image(imgs.floor, x * 11, y * 11, 12, 12)
                            }
                            else if (window.brout.room[x][y] == 35)
                            {
                                image(imgs.wall, x * 11, y * 11, 12, 12)
                            }
                            else if (window.brout.room[x][y] == 48)
                            {
                                image(imgs.door, x * 11, y * 11, 12, 12)
                            }
                        }
                    }
                    image(imgs.human, brout.player.x * 11, brout.player.y * 11, 12, 12)
                }
            }
            main()
        </script>
    </body>
</html>